{% extends 'base.html' %}

{% block title %}{{ epic.title }}{% endblock %}

{% block content %}
<div class="header">
    <div>
        <a href="{% url 'epic-list' %}" class="no-decoration text-muted">&larr; Quay l·∫°i danh s√°ch Epics</a>
        <h1 class="mt-05">{{ epic.title }}</h1>
        <p class="text-muted mt-n1">{{ epic.description }}</p>
    </div>
    <button class="btn btn-dark" onclick="showCreateTaskModal()">+ Th√™m Task m·ªõi</button>
</div>

<h2>Danh s√°ch nhi·ªám v·ª•</h2>
<div id="task-list">
    {% for task in epic.tasks.all %}
    <div class="task-list-item" onclick="loadTaskDetail('{% url 'task-update' task.pk %}', '{% autoescape off %}{{ task.pk }}{% endautoescape %}')">
        <div>
            <p class="m-0 fw-500">{{ task.title }}</p>
            <small class="text-muted">
                üóìÔ∏è {{ task.start_day|date:"Y-m-d" }} &nbsp; ‚è≥ {{ task.duration }} ng√†y &nbsp; üìã Sub-tasks: {{ task.subtasks.count }}
            </small>
        </div>
        {% if task.status == 'COMPLETED' %}
            <span class="status-badge status-hoanthanh">Ho√†n th√†nh</span>
        {% elif task.status == 'IN_PROGRESS' %}
            <span class="status-badge status-dangthuchien">ƒêang th·ª±c hi·ªán</span>
        {% elif task.status == 'BLOCKED' %}
            <span class="status-badge status-chan">Ch·∫∑n</span>
        {% else %}
            <span class="status-badge status-chothuchien">Ch·ªù th·ª±c hi·ªán</span>
        {% endif %}
    </div>
    {% empty %}
    <p>Ch∆∞a c√≥ nhi·ªám v·ª• n√†o trong Epic n√†y.</p>
    {% endfor %}
</div>

<div id="createTaskModalContent" style="display:none;">
    <div class="modal-header">
        <h2>Th√™m Task m·ªõi</h2>
        <span class="close-btn" onclick="closeModal()">&times;</span>
    </div>
    <form id="task-create-form" action="{% url 'task-create' epic_pk=epic.pk %}" method="post">
        {% csrf_token %}
        <div class="modal-body" style="padding: 1rem;">
            <div class="form-group">
                <label for="id_title_create">T√™n nhi·ªám v·ª•</label>
                <input type="text" name="title" id="id_title_create" required>
            </div>
            <div class="form-group-inline">
                <div class="form-group">
                    <label for="id_start_day_create">Ng√†y b·∫Øt ƒë·∫ßu</label>
                    <input style="width: 80%" type="date" name="start_day" id="id_start_day_create" required>
                </div>
                <div class="form-group">
                    <label for="id_duration_create">Th·ªùi gian (ng√†y)</label>
                    <input type="number" name="duration" value="1" id="id_duration_create" required>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn" onclick="closeModal()">H·ªßy</button>
            <button type="submit" class="btn btn-dark">Th√™m Task</button>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}{% endblock %}